{"version":3,"sources":["webpack:///webpack/bootstrap 18fdbd7d77467755c486","webpack:///./source/javascripts/colors.js","webpack:///./source/javascripts/transactionFlow.js","webpack:///./source/javascripts/index.js","webpack:///./source/javascripts/pixelStorage.js","webpack:///./source/javascripts/canvas.js","webpack:///./source/javascripts/hooks.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,C;;;;;;ACzCA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAO;AACP,KAAK;;AAEL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,iC;;;;;;;AC1FA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA,M;;;;;;;ACvEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA,CAAC;;AAED;AACA;;AAEA;AACA;;AAEA;AACA,UAAU,uCAAuC;AACjD;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,6CAA6C,0CAA0C;AACvF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC7NA;AACA;;AAEA;AACA;AACA;AACA,uDAAuD;AACvD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,mBAAmB,6BAA6B;AAChD;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,mBAAmB,mBAAmB;AACtC;AACA;AACA;AACA;AACA;AACA;;AAEA,wB;;;;;;;AC1FA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA,kBAAkB,mDAAmD;AACrE;;AAEA;AACA,iBAAiB,+DAA+D;AAChF;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA,GAAG;AACH;;AAEA;AACA,+CAA+C;AAC/C,+BAA+B,eAAe;AAC9C;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;AACH;;AAEA;AACA,+CAA+C;AAC/C,6BAA6B,kCAAkC;;AAE/D;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,wBAAwB;AACxB;AACA;AACA,CAAC;AACD;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA,0BAA0B,iBAAiB;AAC3C;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C","file":"index.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 18fdbd7d77467755c486","const COLORS = {\n  \"white\": [0xff, 0xff, 0xff, 0xff],\n  \"black\": [0x22, 0x22, 0x22, 0xff],\n  \"lightgrey\": [0xe4, 0xe4, 0xe4, 0xff],\n  \"darkgrey\": [0x88, 0x88, 0x88, 0xff],\n  \"yellow\": [0xe5, 0xdb, 0x00, 0xff],\n  \"orange\": [0xe7, 0x96, 0x00, 0xff],\n  \"brown\": [0xa2, 0x6b, 0x3e, 0xff],\n  \"red\": [0xe7, 0x00, 0x00, 0xff],\n  \"pink\": [0xff, 0xa5, 0xd1, 0xff],\n  \"lightpurple\": [0xd0, 0x69, 0xe6, 0xff],\n  \"purple\": [0x83, 0x00, 0x81, 0xff],\n  \"blue\": [0x00, 0x00, 0xee, 0xff],\n  \"teal\": [0x00, 0xd3, 0xdf, 0xff],\n  \"skyblue\": [0x00, 0x82, 0xca, 0xff],\n  \"green\": [0x00, 0xc0, 0x00, 0xff],\n  \"lightgreen\": [0x92, 0xe2, 0x35, 0xff],\n}\n\nconst INT_TO_COLOR = [\n  COLORS[\"white\"],\n  COLORS[\"black\"],\n  COLORS[\"lightgrey\"],\n  COLORS[\"darkgrey\"],\n  COLORS[\"yellow\"],\n  COLORS[\"orange\"],\n  COLORS[\"brown\"],\n  COLORS[\"red\"],\n  COLORS[\"pink\"],\n  COLORS[\"lightpurple\"],\n  COLORS[\"purple\"],\n  COLORS[\"blue\"],\n  COLORS[\"teal\"],\n  COLORS[\"skyblue\"],\n  COLORS[\"green\"],\n  COLORS[\"lightgreen\"],\n]\n\nmodule.exports = {\n  COLORS: COLORS,\n  INT_TO_COLOR: INT_TO_COLOR\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/javascripts/colors.js\n// module id = 0\n// module chunks = 0 1","const COLORS = require('./colors.js');\n\nclass TransactionFlow {\n  constructor(canvas, pixelStorage) {\n    var that = this;\n    this.modal = $('#modal');\n    this.modalHeading = $('#modal-heading');\n    this.modalText = $('#modal-text');\n    this.state = 'not_started';\n    this.canvas = canvas;\n    this.pixelStorage = pixelStorage;\n  }\n\n  start(pixelX, pixelY, colorIndex) {\n    // TODO: add support for any web3 provider (see which ones work with existing code)\n    if (typeof web3.currentProvider.isMetaMask == 'undefined') {\n      this.modalHeading.text(\"Please install MetaMask\");\n      this.modalText.text(\"MetaMask is a digital wallet which enables your web browser to interact with the Ethereum network.\");\n      this.modal.show();\n      $('#metamask-button-wrapper').show();\n      this.state = 'missing_metamask';\n      this.showCloseButton();\n      return false;\n    }\n\n    this.modalHeading.text(\"Placing a pixel\");\n    this.modalText.text(\"To place a pixel, you need to send 0.001 ETH (about $1.30). This transaction will consume about 45,000 gas.\");\n\n    this.modal.show();\n    $('#send-button').show();\n    $('#cancel-button').show();\n\n    this.state = 'started';\n    this.canvas.updatePixel(pixelX, pixelY, colorIndex);\n\n    var that = this;\n\n    $('#send-button').on('click', function() {\n      that.pixelStorage.sendPixelUpdate(that.canvas.pixelIndex(pixelX, pixelY), colorIndex, function(err, tx_hash) {\n        if (err) {\n          return that.metaMaskError(err)\n        }\n\n        that.transactionCreated(tx_hash)\n      });\n    });\n\n    $('#cancel-button').on('click', function() {\n      that.kill();\n    });\n  }\n\n  metaMaskError(error) {\n    this.modalHeading.text(\"Transaction failed\");\n    this.modalText.text(\"It looks like you cancelled the transaction, or there was a problem.  Please make sure your MetaMask wallet is unlocked.\");\n    this.showCloseButton();\n  }\n\n  transactionCreated(tx_hash) {\n    this.modalHeading.text(\"Transaction created\");\n    this.modalText.text(\"Your transaction was created successfully!  You should see your pixel update in a few minutes, depending on how busy the Ethereum network is.  Your transaction ID is: \" + tx_hash);\n\n    this.showCloseButton();\n  }\n\n  showCloseButton() {\n    $('#cancel-button').hide();\n    $('#send-button').hide();\n    $('#close-button').show();\n\n    const that = this;\n    $('#close-button').on('click', function() {\n      that.kill();\n    });\n  }\n\n  kill() {\n    this.modal.hide();\n    this.state = 'killed';\n\n    $('#cancel-button').off();\n    $('#send-button').off();\n    $('#close-button').off();\n\n    $('#close-button').hide();\n    $('#send-button').hide();\n    $('#cancel-button').hide();\n  }\n}\n\nmodule.exports = TransactionFlow;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/javascripts/transactionFlow.js\n// module id = 1\n// module chunks = 0 1","'use strict';\n\nconst pixelStorage = require('./pixelStorage.js');\nconst TransactionFlow = require('./transactionFlow.js');\nconst Canvas = require('./canvas.js');\nconst hooks = require('./hooks.js');\nconst COLORS = require('./colors.js');\n\nfunction main() {\n  const state = {\n    currentColor: 14,\n    cursorX: 0,\n    cursorY: 0,\n    draggingMouse: false,\n    scale: 4.0,\n    translateX: -563,\n    translateY: -534,\n    lastBlockNumber: 0,\n    transactionFlow: null\n  }\n\n  const canvas = new Canvas(1000, $(\"#canvas\")[0]);\n\n  pixelStorage.getCanvasData(function(err, packedInts, lastBlockNumber) {\n    const unpackedInts = pixelStorage.unpackUIntArray(packedInts);\n    canvas.setDataFromInts(unpackedInts);\n    // canvas.setRandomData();\n    state.lastBlockNumber = lastBlockNumber;\n    $('#block-number').text(state.lastBlockNumber);\n\n    if (isMobile()) {\n      setupMobileHooks(state, canvas, pixelStorage);\n    } else {\n      setupHooks(state, canvas, pixelStorage);\n    };\n  });\n\n  hooks.initializeStateFromHash(state);\n}\n\nfunction setupHooks(state, canvas, pixelStorage) {\n  $(document).ready(function() {\n    hooks.setupAnimationHook(state, canvas);\n    hooks.setupZoomHooks(state);\n    hooks.setupPanHooks(state);\n    hooks.setupHoverHook();\n    hooks.setupPalette(state);\n    hooks.setupHighlightHook(state);\n    hooks.disableScroll();\n    hooks.setupCanvasClickHook(state, canvas, pixelStorage);\n    hooks.setupHashUpdater(state);\n    hooks.setupCanvasChangePoller(state, pixelStorage, canvas);\n    window.scrollTo(0, 0);\n  });\n}\n\n// Mobile is read-only; hide the edit functionality and use touch-based pan and zoom\nfunction setupMobileHooks(state, canvas, pixelStorage) {\n  $(document).ready(function() {\n    hooks.setupAnimationHook(state, canvas);\n    hooks.setupMobileZoomHook(state);\n    hooks.setupMobilePanHook(state);\n    hooks.setupCanvasChangePoller(state, pixelStorage, canvas);\n    window.scrollTo(0, 0);\n  });\n}\n\nfunction isMobile() {\n  return window.matchMedia(\"(max-width: 700px)\").matches;\n}\n\nmain()\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/javascripts/index.js\n// module id = 2\n// module chunks = 0 1","'use strict';\n\nconst PIXEL_STORAGE_ADDRESS = '0xb92d13833f9044eb0c14893a4bb4cb009c209beb';\nconst CONTRACT_ABI = [\n  {\n    \"constant\": true,\n    \"inputs\": [\n      {\n        \"name\": \"\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"name\": \"packedBytes\",\n    \"outputs\": [\n      {\n        \"name\": \"\",\n        \"type\": \"bytes1\"\n      }\n    ],\n    \"payable\": false,\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"constant\": true,\n    \"inputs\": [],\n    \"name\": \"getAll\",\n    \"outputs\": [\n      {\n        \"name\": \"\",\n        \"type\": \"bytes1[500000]\"\n      }\n    ],\n    \"payable\": false,\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"anonymous\": false,\n    \"inputs\": [\n      {\n        \"indexed\": true,\n        \"name\": \"index\",\n        \"type\": \"uint32\"\n      },\n      {\n        \"indexed\": false,\n        \"name\": \"color\",\n        \"type\": \"uint8\"\n      }\n    ],\n    \"name\": \"PixelUpdate\",\n    \"type\": \"event\"\n  },\n  {\n    \"constant\": false,\n    \"inputs\": [\n      {\n        \"name\": \"index\",\n        \"type\": \"uint32\"\n      },\n      {\n        \"name\": \"color\",\n        \"type\": \"uint8\"\n      }\n    ],\n    \"name\": \"set\",\n    \"outputs\": [],\n    \"payable\": true,\n    \"stateMutability\": \"payable\",\n    \"type\": \"function\"\n  },\n  {\n    \"constant\": false,\n    \"inputs\": [\n      {\n        \"name\": \"fee\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"name\": \"setFee\",\n    \"outputs\": [],\n    \"payable\": false,\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  },\n  {\n    \"constant\": false,\n    \"inputs\": [],\n    \"name\": \"withdraw\",\n    \"outputs\": [],\n    \"payable\": false,\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"name\": \"startingFeeWei\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"payable\": false,\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"constructor\"\n  },\n  {\n    \"payable\": true,\n    \"stateMutability\": \"payable\",\n    \"type\": \"fallback\"\n  }\n];\n\nvar pixelStorage = null;\n\nwindow.addEventListener('load', function() {\n  if (typeof window.web3 !== 'undefined') {\n    window.web3 = new Web3(web3.currentProvider);\n  } else {\n    window.web3 = new Web3(new Web3.providers.HttpProvider('https://rinkeby.infura.io/metamask'));\n  }\n\n  pixelStorage = new window.web3.eth.Contract(CONTRACT_ABI, PIXEL_STORAGE_ADDRESS);\n});\n\nfunction sendPixelUpdate(pixelIndex, colorIndex, callback) {\n  // TODO: check web3.isConnected() before attempting this transaction\n\n  // hack to get selected address from metamask (web3.js 1.0 breaks the default way)\n  const address = web3.givenProvider.publicConfigStore._state.selectedAddress\n\n  pixelStorage.methods.set(pixelIndex, colorIndex).\n    send({from: address, value: 1000000000000000}, function(err, transactionHash) {\n      if (err) {\n        console.log(err);\n        return callback(err);\n      }\n\n      console.log(\"sent tx!\", transactionHash);\n      callback(null, transactionHash);\n  });\n}\n\nfunction sortLogs(logs) {\n  // sort by blockNumber and transactionIndex\n  return logs.\n    sort(function(a, b){\n      if (a.blockNumber === b.blockNumber) {\n        // if two logs have the same block, order by transactionIndex:\n        return (a.transactionIndex < b.transactionIndex) ? -1 : 1;\n      } else {\n        return (a.blockNumber < b.blockNumber) ? -1 : 1;\n      }\n    })\n}\n\nfunction getPixelUpdatesSince(blockNumber, callback) {\n  // order = blockindex + transactionIndex + logIndex\n  pixelStorage.getPastEvents('PixelUpdate', {fromBlock: blockNumber, toBlock: 'latest'}, function(err, logs){\n    if (err) {\n      callback(err);\n    }\n\n    const changes = logs.map(function(log){\n      return {\n        blockNumber: log.blockNumber,\n        transactionIndex: log.transactionIndex,\n        logIndex: log.logIndex,\n        pixelIndex: log.returnValues['index'],\n        color: log.returnValues['color']\n      };\n    });\n\n    callback(null, sortLogs(changes));\n  });\n}\n\n// Pack 2 positive 4-bit integers into 8 bits\n// pack(0b0100, 0b1011) => 0x01001011\nfunction pack(a, b) {\n  return a << 4 | b;\n}\n\nfunction unpack(byte) {\n  const left = (byte >>> 4) & 0xf;\n  const right = byte & 0xf;\n  return [left, right];\n}\n\nfunction unpackUIntArray(packedInts) {\n  var unpackedInts = [];\n\n  packedInts.forEach(function(packedInt) {\n    const unpacked = unpack(packedInt);\n    unpackedInts.push(unpacked[0]);\n    unpackedInts.push(unpacked[1]);\n  });\n\n  return unpackedInts;\n}\n\nfunction getCanvasData(callback) {\n  const req = new XMLHttpRequest();\n  req.open(\"GET\", \"https://api.cryptopaint.co/pixels\", true);\n  req.responseType = \"arraybuffer\";\n\n  req.onload = function(oEvent) {\n    const byteArray = new Uint8Array(req.response);\n    const lastBlockNumber = parseInt(req.getResponseHeader('X-Last-Updated-Block'), 16);\n    console.log(lastBlockNumber)\n    callback(null, byteArray, lastBlockNumber);\n  };\n\n  req.send(null);\n}\n\nmodule.exports = {\n  sendPixelUpdate: sendPixelUpdate,\n  getPixelUpdatesSince: getPixelUpdatesSince,\n  unpackUIntArray: unpackUIntArray,\n  getCanvasData: getCanvasData\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/javascripts/pixelStorage.js\n// module id = 3\n// module chunks = 0 1","'use strict';\nconst COLORS = require('./colors.js');\n\nfunction getRandomInt(min, max) {\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive\n}\n\nclass Canvas {\n  constructor(width, element) {\n    this.width = width;\n    this.canvas = element;\n    this.context = this.canvas.getContext('2d');\n    this.data = null;\n    this.imageData = null;\n  }\n\n  setRandomData() {\n    this.data = this._randomColorArray(this.width);\n  }\n\n  setDataFromInts(ints) {\n    var array = new Uint8ClampedArray(this.width * this.width * 4);\n\n    for (var x = 0; x < this.width * this.width; x++) {\n      array.set(COLORS.INT_TO_COLOR[ints[x]], x * 4);\n    }\n\n    this.data = array;\n  }\n\n    // var dataArray = new Uint8ClampedArray([\n    //   255, 166, 82, 255,\n    //   255, 166, 82, 255,\n    //   255, 166, 82, 255,\n    //   255, 166, 82, 255]);\n\n  draw() {\n    if (this.imageData == null) {\n      this.imageData = new ImageData(this.data, this.width, this.width);\n    }\n    this.context.putImageData(this.imageData, 0, 0);\n  }\n\n  drawHighlight(x, y, colorIndex) {\n    if (x >= this.width || y >= this.width) {\n      return;\n    }\n\n    const color = COLORS.INT_TO_COLOR[colorIndex];\n    this.context.fillStyle = 'rgba(' + color.join(',') +')';\n    this.context.fillRect(x, y, 1, 1);\n  }\n\n  updatePixel(x, y, colorIndex) {\n    const offset = this._arrayOffset(x,y);\n    this.data.set(COLORS.INT_TO_COLOR[colorIndex], offset);\n  }\n\n  getPixelColor(x, y) {\n    const offset = this._arrayOffset(x,y);\n    return this.data.slice(offset, offset + 4);\n  }\n\n  pixelIndex(x, y) {\n    return y * this.width + x;\n  }\n\n  indexToCoordinates(index) {\n    const x = index % this.width;\n    const y = Math.floor(index / this.width);\n    return [x, y];\n  }\n\n  _arrayOffset(x, y) {\n    return (y * this.width * 4) + x * 4;\n  }\n\n  _randomColorArray(width) {\n    var array = new Uint8ClampedArray(width * width * 4);\n\n    for (var x = 0; x < width * width; x++) {\n      var color = COLORS.INT_TO_COLOR[getRandomInt(0, 16)];\n      array.set(color, x * 4);\n    }\n    return array;\n  }\n}\n\nmodule.exports = Canvas;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/javascripts/canvas.js\n// module id = 4\n// module chunks = 0 1","'use strict';\n\nconst COLORS = require('./colors.js');\nconst MIN_SCALE = 4.0;\nconst MAX_SCALE = 50.0;\nconst POLL_INTERVAL_MS = 5000;\nconst TransactionFlow = require('./transactionFlow.js');\n\nfunction initializeStateFromHash(state) {\n  const hash = window.location.hash;\n  const matches = hash.match(/^#scale=(\\d+)&x=(\\d+)&y=(\\d+)$/);\n\n  if (matches == null) {\n    setScale(state.scale);\n    setTranslate(state.translateX, state.translateY);\n    return;\n  }\n\n  state.scale = parseInt(matches[1]);\n  state.translateX = -1 * parseInt(matches[2]);\n  state.translateY = -1 * parseInt(matches[3]);\n\n  setScale(state.scale);\n  setTranslate(state.translateX, state.translateY);\n}\n\nfunction setupHashUpdater(state) {\n  setInterval(function() {\n    window.location.hash =\n      \"scale=\" + state.scale +\n      \"&x=\" + -1 * Math.round(state.translateX) +\n      \"&y=\" + -1 * Math.round(state.translateY);\n  }, 500);\n}\n\nfunction setScale(scale) {\n  $('#zoom').css({'transform' : 'scale(' + scale +', ' + scale + ')'});\n}\n\nfunction setTranslate(x, y) {\n  $('#pan').css({'transform' : 'translate(' + (x+500) +'px, ' + (y+500) + 'px)'});\n}\n\nfunction setupZoomHooks(state) {\n  // set up listener to zoom on mousewheel:\n  $(document).on('mousewheel', function(event){\n    // prevent mousewheel from scrolling page\n    event.preventDefault();\n\n    state.scale = Math.round(state.scale + 0.5 * event.deltaY);\n\n    // enforce bounds:\n    if (state.scale < MIN_SCALE) {\n      state.scale = MIN_SCALE;\n    } else if (state.scale > MAX_SCALE) {\n      state.scale = MAX_SCALE;\n    }\n\n    setScale(state.scale);\n  });\n}\n\nfunction setupMobileZoomHook(state) {\n  var hammertime = new Hammer(document.body, {});\n  hammertime.get('pinch').set({ enable: true });\n  hammertime.on('pinch', function(event) {\n    setScale(state.scale * event.scale);\n  });\n\n  hammertime.on('pinchend', function(event) {\n    state.scale *= event.scale;\n  });\n}\n\nfunction setupMobilePanHook(state) {\n  var hammertime = new Hammer(document.body, {});\n  hammertime.get('pan').set({ direction: Hammer.DIRECTION_ALL });\n\n  hammertime.on('panmove', function(event) {\n    setTranslate(state.translateX + event.deltaX * 0.5, state.translateY + event.deltaY * 0.5);\n  });\n\n  hammertime.on('panend', function(event) {\n    state.translateX += (event.deltaX * 0.5);\n    state.translateY += (event.deltaY * 0.5);\n  });\n}\n\nfunction setupPanHooks(state) {\n  // click-to-drag logic:\n  var mousedownX = 0;\n  var mousedownY = 0;\n  var mousedown = false;\n\n  $(document).on('mousedown', function(event){\n    mousedownX = event.clientX;\n    mousedownY = event.clientY;\n    mousedown = true;\n    state.draggingMouse = false;\n  });\n\n  $(document).on('mouseup', function(event){\n    mousedown = false;\n    state.draggingMouse = false;\n  });\n\n  $(document).on('mousemove', function(event){\n    if (mousedown == false) {\n      return;\n    }\n\n    state.draggingMouse = true;\n\n    var currentX = event.clientX;\n    var currentY = event.clientY;\n\n    var deltaX = currentX - mousedownX;\n    var deltaY = currentY - mousedownY;\n\n    // update last mousedown\n    mousedownX = currentX;\n    mousedownY = currentY;\n\n    // TODO: set max bounds on translation\n    state.translateX = state.translateX + deltaX * 0.3;\n    state.translateY = state.translateY + deltaY * 0.3;\n    setTranslate(state.translateX, state.translateY);\n  });\n\n  $(document).on('keydown', function(event) {\n    switch(event.which) {\n        case 65: // a\n        state.translateX += 1;\n        break;\n\n        case 37: // left\n        state.translateX += 1;\n        break;\n\n        case 87: // w\n        state.translateY += 1;\n        break\n\n        case 38: // up\n        state.translateY += 1;\n        break;\n\n        case 68: // d\n        state.translateX += -1;\n        break;\n\n        case 39: // right\n        state.translateX += -1;\n        break;\n\n        case 83: // s\n        state.translateY += -1;\n        break;\n\n        case 40: // down\n        state.translateY += -1;\n        break;\n\n        default: return; // exit this handler for other keys\n    }\n    setTranslate(state.translateX, state.translateY);\n});\n}\n\nfunction disableScroll() {\n  $(document).on('keydown', function(event){\n    if([32, 33, 34, 37, 38, 39, 40].indexOf(event.keyCode) > -1) {\n      event.preventDefault();\n    }\n  });\n}\n\nfunction setupHoverHook() {\n  $(\"#canvas\").on('mousemove', function(event){\n    const pixelX = event.offsetX;\n    const pixelY = event.offsetY;\n    $('#coordinates').text(\"(\"+pixelX+\", \"+pixelY+\")\");\n  });\n}\n\nfunction setupHighlightHook(state) {\n  $(\"#canvas\").on('mousemove', function(event){\n    state.cursorX = event.offsetX;\n    state.cursorY = event.offsetY;\n  });\n}\n\nfunction setupPalette(state) {\n  // TODO: use React to create these components and maintain state?\n  for (var colorIndex = 0; colorIndex < 16; colorIndex++) {\n    const newButton = $('.color-button').first().clone();\n    newButton.css('background-color', \"rgba(\" + COLORS.INT_TO_COLOR[colorIndex].join(\",\") + \")\");\n    newButton.appendTo($('#palette'));\n\n    const i = colorIndex;\n    newButton.on('click', function() {\n      state['currentColor'] = i;\n    });\n  }\n\n  $('.color-button').first().remove();\n}\n\nfunction setupAnimationHook(state, canvas) {\n  function drawFrame(timestamp) {\n    canvas.draw();\n    canvas.drawHighlight(state.cursorX, state.cursorY, state.currentColor);\n    window.requestAnimationFrame(drawFrame);\n  }\n\n  window.requestAnimationFrame(drawFrame);\n}\n\nfunction setupCanvasClickHook(state, canvas, pixelStorage) {\n  $(\"#canvas\").on('mouseup', function(event){\n    if (state.draggingMouse == true) {\n      return;\n    }\n\n    if (state.transactionFlow != null && state.transactionFlow.state !== 'killed') {\n      return;\n    }\n\n    const pixelX = event.offsetX;\n    const pixelY = event.offsetY;\n\n    state.transactionFlow = new TransactionFlow(canvas, pixelStorage);\n    state.transactionFlow.start(pixelX, pixelY, state.currentColor);\n  });\n}\n\nfunction setupCanvasChangePoller(state, pixelStorage, canvas) {\n  setInterval(function() {\n    pixelStorage.getPixelUpdatesSince(state.lastBlockNumber, function(err, changes) {\n      if (err) {\n        return console.log(err);\n      }\n\n      changes.forEach(function(change) {\n        const coordinates = canvas.indexToCoordinates(change.pixelIndex);\n        canvas.updatePixel(coordinates[0], coordinates[1], change.color)\n      });\n\n      if (changes.length == 0) {\n        return;\n      }\n\n      // update lastblock\n      const lastBlockNumber = changes[changes.length - 1].blockNumber;\n      state.lastBlockNumber = lastBlockNumber;\n    });\n\n    $('#block-number').text(state.lastBlockNumber);\n  }, POLL_INTERVAL_MS);\n}\n\nmodule.exports = {\n  setupZoomHooks: setupZoomHooks,\n  setupPanHooks: setupPanHooks,\n  disableScroll: disableScroll,\n  setupHoverHook: setupHoverHook,\n  setupHighlightHook: setupHighlightHook,\n  setupPalette: setupPalette,\n  setupAnimationHook: setupAnimationHook,\n  setupCanvasClickHook: setupCanvasClickHook,\n  setupHashUpdater: setupHashUpdater,\n  initializeStateFromHash: initializeStateFromHash,\n  setupCanvasChangePoller: setupCanvasChangePoller,\n  setupMobileZoomHook: setupMobileZoomHook,\n  setupMobilePanHook: setupMobilePanHook\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/javascripts/hooks.js\n// module id = 5\n// module chunks = 0 1"],"sourceRoot":""}