!function(t){var e={};function n(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:a})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e){const n={white:[255,255,255,255],black:[34,34,34,255],lightgrey:[228,228,228,255],darkgrey:[136,136,136,255],yellow:[229,219,0,255],orange:[231,150,0,255],brown:[162,107,62,255],red:[231,0,0,255],pink:[255,165,209,255],lightpurple:[208,105,230,255],purple:[131,0,129,255],blue:[0,0,238,255],teal:[0,211,223,255],skyblue:[0,130,202,255],green:[0,192,0,255],lightgreen:[146,226,53,255]},a=[n.white,n.black,n.lightgrey,n.darkgrey,n.yellow,n.orange,n.brown,n.red,n.pink,n.lightpurple,n.purple,n.blue,n.teal,n.skyblue,n.green,n.lightgreen];t.exports={COLORS:n,INT_TO_COLOR:a}},function(t,e,n){n(0);t.exports=class{constructor(t,e){this.modal=$("#modal"),this.modalHeading=$("#modal-heading"),this.modalText=$("#modal-text"),this.state="not_started",this.canvas=t,this.pixelStorage=e}start(t,e,n){if(void 0===web3.currentProvider.isMetaMask)return this.modalHeading.text("Please install MetaMask"),this.modalText.text("MetaMask is a digital wallet which enables your web browser to interact with the Ethereum network."),this.modal.show(),$("#metamask-button-wrapper").show(),this.state="missing_metamask",this.showCloseButton(),!1;this.modalHeading.text("Placing a pixel"),this.modalText.text("To place a pixel, you need to send 0.001 ETH (about $1.20), plus the gas fee (about 40,000 gas)."),this.modal.show(),$("#send-button").show(),$("#cancel-button").show(),this.state="started",this.canvas.updatePixel(t,e,n);var a=this;$("#send-button").on("click",function(){a.pixelStorage.sendPixelUpdate(a.canvas.pixelIndex(t,e),n,function(t,e){if(t)return a.metaMaskError(t);a.transactionCreated(e)})}),$("#cancel-button").on("click",function(){a.kill()})}metaMaskError(t){this.modalHeading.text("Transaction failed"),this.modalText.text("It looks like you cancelled the transaction, or there was a problem.  Please make sure your MetaMask wallet is unlocked."),this.showCloseButton()}transactionCreated(t){this.modalHeading.text("Transaction created"),this.modalText.text("Your transaction was created successfully!  You should see your pixel update in less than 5 minutes."),this.showCloseButton()}showCloseButton(){$("#cancel-button").hide(),$("#send-button").hide(),$("#close-button").show();const t=this;$("#close-button").on("click",function(){t.kill()})}kill(){this.modal.hide(),this.state="killed",$("#cancel-button").off(),$("#send-button").off(),$("#close-button").off(),$("#close-button").hide(),$("#send-button").hide(),$("#cancel-button").hide()}}},function(t,e,n){"use strict";const a=n(3),o=(n(1),n(4)),s=n(5);n(0);!function(){const t={currentColor:14,cursorX:0,cursorY:0,draggingMouse:!1,scale:4,translateX:500,translateY:500,lastBlockNumber:0,transactionFlow:null},e=new o(1e3,$("#canvas")[0]);a.getCanvasData(function(n,o,i){const r=a.unpackUIntArray(o);var l,c,u;e.setDataFromInts(r),t.lastBlockNumber=i,$("#block-number").text(t.lastBlockNumber),l=t,c=e,u=a,$(document).ready(function(){s.setupAnimationHook(l,c),s.setupZoomHooks(l),s.setupPanHooks(l),s.setupHoverHook(),s.setupPalette(l),s.setupHighlightHook(l),s.disableScroll(),s.setupCanvasClickHook(l,c,u),s.setupHashUpdater(l),s.setupCanvasChangePoller(l,u,c),window.scrollTo(0,0)})}),s.initializeStateFromHash(t)}()},function(t,e,n){"use strict";const a=[{constant:!0,inputs:[{name:"",type:"uint256"}],name:"packedBytes",outputs:[{name:"",type:"bytes1"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getAll",outputs:[{name:"",type:"bytes1[500000]"}],payable:!1,stateMutability:"view",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"index",type:"uint32"},{indexed:!1,name:"color",type:"uint8"}],name:"PixelUpdate",type:"event"},{constant:!1,inputs:[{name:"index",type:"uint32"},{name:"color",type:"uint8"}],name:"set",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"fee",type:"uint256"}],name:"setFee",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[],name:"withdraw",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"startingFeeWei",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{payable:!0,stateMutability:"payable",type:"fallback"}];var o=null;window.addEventListener("load",function(){void 0!==window.web3?window.web3=new Web3(web3.currentProvider):window.web3=new Web3(new Web3.providers.HttpProvider("https://rinkeby.infura.io/metamask")),o=new window.web3.eth.Contract(a,"0xead504431dcc01142c0b9cdb9367b57932672079")}),t.exports={sendPixelUpdate:function(t,e,n){const a=web3.givenProvider.publicConfigStore._state.selectedAddress;o.methods.set(t,e).send({from:a,value:1e15},function(t,e){if(t)return console.log(t),n(t);console.log("sent tx!",e),n(null,e)})},getPixelUpdatesSince:function(t,e){o.getPastEvents("PixelUpdate",{fromBlock:t,toBlock:"latest"},function(t,n){t&&e(t);const a=n.map(function(t){return{blockNumber:t.blockNumber,transactionIndex:t.transactionIndex,logIndex:t.logIndex,pixelIndex:t.returnValues.index,color:t.returnValues.color}});e(null,a.sort(function(t,e){return t.blockNumber===e.blockNumber?t.transactionIndex<e.transactionIndex?-1:1:t.blockNumber<e.blockNumber?-1:1}))})},unpackUIntArray:function(t){var e=[];return t.forEach(function(t){const n=[(a=t)>>>4&15,15&a];var a;e.push(n[0]),e.push(n[1])}),e},getCanvasData:function(t){const e=new XMLHttpRequest;e.open("GET","https://api.cryptopaint.co/pixels",!0),e.responseType="arraybuffer",e.onload=function(n){const a=new Uint8Array(e.response),o=parseInt(e.getResponseHeader("X-Last-Updated-Block"),16);console.log(o),t(null,a,o)},e.send(null)}}},function(t,e,n){"use strict";const a=n(0);t.exports=class{constructor(t,e){this.width=t,this.canvas=e,this.context=this.canvas.getContext("2d"),this.data=null,this.imageData=null}setRandomData(){this.data=this._randomColorArray(this.width)}setDataFromInts(t){for(var e=new Uint8ClampedArray(this.width*this.width*4),n=0;n<this.width*this.width;n++)e.set(a.INT_TO_COLOR[t[n]],4*n);this.data=e}draw(){null==this.imageData&&(this.imageData=new ImageData(this.data,this.width,this.width)),this.context.putImageData(this.imageData,0,0)}drawHighlight(t,e,n){if(t>=this.width||e>=this.width)return;const o=a.INT_TO_COLOR[n];this.context.fillStyle="rgba("+o.join(",")+")",this.context.fillRect(t,e,1,1)}updatePixel(t,e,n){const o=this._arrayOffset(t,e);this.data.set(a.INT_TO_COLOR[n],o)}getPixelColor(t,e){const n=this._arrayOffset(t,e);return this.data.slice(n,n+4)}pixelIndex(t,e){return e*this.width+t}indexToCoordinates(t){const e=t%this.width,n=Math.floor(t/this.width);return[e,n]}_arrayOffset(t,e){return e*this.width*4+4*t}_randomColorArray(t){for(var e,n,o=new Uint8ClampedArray(t*t*4),s=0;s<t*t;s++){var i=a.INT_TO_COLOR[(e=0,n=16,e=Math.ceil(e),n=Math.floor(n),Math.floor(Math.random()*(n-e))+e)];o.set(i,4*s)}return o}}},function(t,e,n){"use strict";const a=n(0),o=4,s=50,i=5e3,r=n(1);function l(t){$("#zoom").css({transform:"scale("+t+", "+t+")"})}function c(t,e){$("#pan").css({transform:"translate("+(t+500)+"px, "+(e+500)+"px)"})}t.exports={setupZoomHooks:function(t){$(document).on("mousewheel",function(e){e.preventDefault(),t.scale=Math.round(t.scale+.5*e.deltaY),t.scale<o?t.scale=o:t.scale>s&&(t.scale=s),l(t.scale)})},setupPanHooks:function(t){var e=0,n=0,a=!1;$(document).on("mousedown",function(o){e=o.clientX,n=o.clientY,a=!0,t.draggingMouse=!1}),$(document).on("mouseup",function(e){a=!1,t.draggingMouse=!1}),$(document).on("mousemove",function(o){if(0!=a){t.draggingMouse=!0;var s=o.clientX,i=o.clientY,r=s-e,l=i-n;e=s,n=i,t.translateX=t.translateX+.3*r,t.translateY=t.translateY+.3*l,c(t.translateX,t.translateY)}}),$(document).on("keydown",function(e){switch(e.which){case 65:case 37:t.translateX+=1;break;case 87:case 38:t.translateY+=1;break;case 68:case 39:t.translateX+=-1;break;case 83:case 40:t.translateY+=-1;break;default:return}c(t.translateX,t.translateY)})},disableScroll:function(){$(document).on("keydown",function(t){[32,33,34,37,38,39,40].indexOf(t.keyCode)>-1&&t.preventDefault()})},setupHoverHook:function(){$("#canvas").on("mousemove",function(t){const e=t.offsetX,n=t.offsetY;$("#coordinates").text("("+e+", "+n+")")})},setupHighlightHook:function(t){$("#canvas").on("mousemove",function(e){t.cursorX=e.offsetX,t.cursorY=e.offsetY})},setupPalette:function(t){for(var e=0;e<16;e++){const n=$(".color-button").first().clone();n.css("background-color","rgba("+a.INT_TO_COLOR[e].join(",")+")"),n.appendTo($("#palette"));const o=e;n.on("click",function(){t.currentColor=o})}$(".color-button").first().remove()},setupAnimationHook:function(t,e){window.requestAnimationFrame(function n(a){e.draw(),e.drawHighlight(t.cursorX,t.cursorY,t.currentColor),window.requestAnimationFrame(n)})},setupCanvasClickHook:function(t,e,n){$("#canvas").on("mouseup",function(a){if(1==t.draggingMouse)return;if(null!=t.transactionFlow&&"killed"!==t.transactionFlow.state)return;const o=a.offsetX,s=a.offsetY;t.transactionFlow=new r(e,n),t.transactionFlow.start(o,s,t.currentColor)})},setupHashUpdater:function(t){setInterval(function(){window.location.hash="scale="+t.scale+"&x="+-1*Math.round(t.translateX)+"&y="+-1*Math.round(t.translateY)},500)},initializeStateFromHash:function(t){const e=window.location.hash.match(/^#scale=(\d+)&x=(\d+)&y=(\d+)$/);null!=e&&(t.scale=parseInt(e[1]),t.translateX=-1*parseInt(e[2]),t.translateY=-1*parseInt(e[3]),l(t.scale),c(t.translateX,t.translateY))},setupCanvasChangePoller:function(t,e,n){setInterval(function(){e.getPixelUpdatesSince(t.lastBlockNumber,function(e,a){if(e)return console.log(e);if(a.forEach(function(t){const e=n.indexToCoordinates(t.pixelIndex);n.updatePixel(e[0],e[1],t.color)}),0==a.length)return;const o=a[a.length-1].blockNumber;t.lastBlockNumber=o}),$("#block-number").text(t.lastBlockNumber)},i)}}}]);